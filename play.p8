pico-8 cartridge // http://www.pico-8.com
version 29
__lua__
function _init()
 __init__()
 mode = move_around
end

function _update60()
 mode()
 ticks += 1 -- = ftime()
end

function _draw()
 draw_move_around()
 print(pc.c,40,40)
end
-->8
--update and draw functions
function move_around()
 if(btnp()&16!=0) mode=act_menu
  --🅾️
 if btn()&15 != 0 then
  --⬇️⬆️➡️⬅️
  local th=dpad_angle[btn()&15]
  if(th) move(pc, btn()&32, th)
   --❎
 else
  pc.c = 2
 end
end

function draw_move_around()
 cls()
 map(0,0,0,0,16,16)
 spr(pc.c+pc.fr[2],pc.posx,
     pc.posy,1,1,pc.flipx)
end

function act_menu()
 if btnp(❎) then
  mode = move_around
 end
 if btnp(🅾️) then
  load("bits.p8")
 end
end
-->8
--frequently called functions
--warning: optimized code ahead
function move(self, spd, th)
 --move self by a 4-bit vector
 --spd 1-bit (slow or fast)
 --th 3-bit (45 deg resolution)
 if ticks%4==3 then
  --every 4 ticks
  self.c=(self.c + 1)%2
  --self.c+=1
 end
 if spd == 0 and ticks%2==1
  --if spd==0 skip 0dd ticks
  or th%2==1 and ticks%5==0
  and rnd(999) < 883 then 
  --if diagonal skip 1/5 ticks
  -- * 883/999 = .707107...
  return
 end 
 local compx = comp[th][1] 
 if compx < 0 then
  self.flipx = false
 elseif compx > 0 then
  self.flipx = true
 end
 self.posx += compx
 self.posy += comp[th][2]
end
-->8
--secret __init__
function __init__()
 local rsin =
  --rounded pico8 sin values
  --each step is 1/8 of circle
  {[0]=0,-1,-1,-1,0,1,1,1}

 local dpad_bf =
  --holds dpad bit fields
  --⬇️⬆️➡️⬅️
  {0b0010,0b0110,0b0100,0b0101,
   0b0001,0b1001,0b1000,0b1010}

 ticks = 0

 comp = {}
  --relates an angle to values
  --to add to posx, posy
  --0={1,0},1={1,-1}...7={1,1}
 for i=0,7 do
  comp[i] =
   --{cos(i)=x, sin(i)=y }
   {rsin[(i-2)%8],rsin[i]}
 end

 dpad_angle={}
  --relates an angle to
  --a specific bit field
  --➡️=0, ⬆️➡️=1...⬇️=6,⬇️➡️=7
 for i=1,8 do
  dpad_angle[dpad_bf[i]] = i-1 
 end
end
-->8
--data structures
pc =
{
 posx=60,
 posy=60,
 flipx=false,
 fr={[0]=18,19,17},
 c=0
}
__gfx__
00000000011111100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000111111110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700111111110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000770001a1111a10000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000111111110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700011e11100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000001111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000001111110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
7dddddd6008888000088880000888800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
d6666665088888800888888008888880000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
d666666508a8a88008a8a88008a8a880000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
d6666665088888800888888008888880000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
d6666665088888800888888008888880000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
d66666650888888008888a8008a88880000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
d666666500a00a0000a00a0000a00a00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
6555555d00a00a0000a0000000000a00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
1010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1000000000000000000000000000001010101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1000000000000000000000000000001000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1000000000000000000000000000001000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1000000000000000000000000000001000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1000000000000000000000000000001000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1000000000000000000000000000001000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1000000000000000000000000000001000000010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1000000000000000000000000000001000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1000000000000000000000000000001000001010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__sfx__
000200001a0701e0702207026070260700d07009000080002c0002c0002b0002800025000200001e0001a00000000000000000000000000000000000000000000000000000000000000000000000000000000000
